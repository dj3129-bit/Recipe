<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="recipe">
	<select id="list" resultType="recipe">
		SELECT *, c.maincategoryname
		FROM recipepost r
		JOIN categorytype c ON r.maincategoryid = c.maincategoryid
	</select>
	
	<insert id="add" useGeneratedKeys="true" keyProperty="recipeid">
		INSERT INTO recipepost (recipetitle, introduce, recipetag, recipeviews, recommend, isprivate, imagepath, maincategoryid, userid)
		VALUES (#{recipetitle}, #{introduce}, #{recipetag}, #{recipeviews}, #{recommend}, #{isprivate}, #{imagepath}, #{maincategoryid}, #{userid})
	</insert>
	
	<select id="item" resultType="Recipe">
		SELECT *
		FROM recipepost
		WHERE recipeid=#{recipeid}
	</select>
	
	<update id="update">
		UPDATE recipepost 
		SET recipetitle=#{recipetitle}, introduce=#{introduce}, recipetag=#{recipetag}, recipeviews=#{recipeviews}, recommend=#{recommend}, 
		isprivate=#{isprivate}, imagepath=#{imagepath}, maincategoryid=#{maincategoryid}
		WHERE recipeid=#{recipeid}
	</update>
	
	<delete id="delete">
		DELETE FROM recipepost
		WHERE recipeid=#{recipeid}
	</delete>
	
	<update id="recommend" parameterType="int">
	  UPDATE recipepost
	  SET recommend = recommend + 1
	  WHERE recipeid = #{recipeid}
	</update>
	
	<select id="recview" parameterType="int" resultType="int">
	  SELECT recommend
	  FROM recipepost
	  WHERE recipeid = #{recipeid}
	</select>
	
	<update id="viewsup" parameterType="int">
	    UPDATE recipepost
	    SET recipeviews = recipeviews + 1
	    WHERE recipeid = #{recipeid}
	</update>
	
	<select id="comlist" resultType="comment">
		SELECT *
		FROM comment
		WHERE recipeid=#{recipeid}
	</select>
	
	<insert id="comment" useGeneratedKeys="true" keyProperty="commentid">
		INSERT INTO comment (recipeid, commentcontent, commentdate, userid)
		VALUES (#{recipeid}, #{commentcontent}, #{commentdate}, #{userid})
	</insert>
</mapper>